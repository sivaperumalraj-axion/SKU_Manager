<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AutoScheduler Pro</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}?v=2">
</head>

<body>
    <header>
        <div class="logo">
            <span>‚ö°</span> AutoScheduler Pro
        </div>
        <div class="status-badge">
            <div class="status-dot"></div>
            System Online
        </div>
    </header>

    <main>
        <!-- Sidebar -->
        <nav class="sidebar">
            <div class="nav-item active" data-target="view-scheduler">
                <span class="icon">üìÖ</span>
                <span class="label">Scheduler</span>
            </div>
            <div class="nav-item" data-target="view-threads">
                <span class="icon">üß©</span>
                <span class="label">Threads</span>
            </div>
            <div class="nav-item" data-target="view-processes">
                <span class="icon">‚öôÔ∏è</span>
                <span class="label">Processes</span>
            </div>
            <div class="nav-item" data-target="view-history">
                <span class="icon">üìú</span>
                <span class="label">History</span>
            </div>
            <div class="nav-item" data-target="view-skus">
                <span class="icon">üì¶</span>
                <span class="label">SKU Manager</span>
            </div>
            <div class="nav-item" data-target="view-database">
                <span class="icon">üóÑÔ∏è</span>
                <span class="label">Database</span>
            </div>
        </nav>

        <!-- Main Content -->
        <div class="content-area">

            <!-- VIEW: Scheduler (Home) -->
            <div id="view-scheduler" class="view active">
                <div class="panel">
                    <div class="panel-header">Upcoming Schedules</div>
                    <div class="panel-body">
                        <!-- Quick Add -->
                        <div class="quick-action-bar">
                            <select id="schedule-process-select" class="form-select">
                                <option value="" disabled selected>Select Process to Schedule...</option>
                            </select>
                            <input type="datetime-local" id="schedule-time-input" class="form-input">
                            <button id="btn-add-schedule" class="btn btn-primary">Schedule Process</button>
                        </div>
                        <hr>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Run Time</th>
                                    <th>Type</th>
                                    <th>Name</th>
                                    <th>Status</th>
                                </tr>
                            </thead>
                            <tbody id="schedules-list-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>

            <!-- VIEW: Threads -->
            <div id="view-threads" class="view hidden">
                <div class="panel">
                    <div class="panel-header">Thread Manager</div>
                    <div class="panel-body">

                        <!-- Create Thread Form -->
                        <div class="form-box">
                            <h4>Create New Thread</h4>
                            <form id="form-create-thread">
                                <div class="form-row">
                                    <input type="text" name="name" placeholder="Thread Name (Unique)" class="form-input"
                                        required>
                                    <select name="type" class="form-select" required>
                                        <option value="Scraping">Scraping Thread</option>
                                        <option value="Others">Other Thread</option>
                                    </select>
                                </div>
                                <div class="form-row">
                                    <label class="file-label">
                                        Scripts (.py, .exe)
                                        <input type="file" name="script_file" required>
                                    </label>
                                    <label class="file-label">
                                        Config/Input (.csv)
                                        <input type="file" name="config_file">
                                    </label>
                                </div>
                                <button type="submit" class="btn btn-success">Create Thread</button>
                            </form>
                        </div>

                        <hr>
                        <h4>Existing Threads</h4>
                        <div id="threads-grid" class="cards-grid">
                            <!-- Populated by JS -->
                        </div>
                    </div>
                </div>
            </div>

            <!-- VIEW: Processes -->
            <div id="view-processes" class="view hidden">
                <div class="panel">
                    <div class="panel-header">Process Builder</div>
                    <div class="panel-body">

                        <!-- Builder Interface -->
                        <div class="builder-container">
                            <div class="builder-left">
                                <h4>1. Available Threads</h4>
                                <ul id="builder-source-list" class="draggable-list">
                                    <!-- List of Threads to Drag/Click -->
                                </ul>
                            </div>
                            <div class="builder-right">
                                <h4>2. Process Sequence</h4>
                                <input type="text" id="builder-process-name" placeholder="Process Name"
                                    class="form-input" style="margin-bottom: 0.5rem;">
                                <ul id="builder-target-list" class="draggable-list target-zone">
                                    <!-- Dropped Items -->
                                    <li class="placeholder">Add threads here...</li>
                                </ul>
                                <button id="btn-save-process" class="btn btn-primary"
                                    style="margin-top: 1rem; width: 100%;">Save Process</button>
                                <button onclick="clearBuilder()" class="btn btn-sm"
                                    style="margin-top: 5px; width: 100%; background: #555; color: white;">Reset /
                                    Cancel</button>
                            </div>
                        </div>

                        <hr>
                        <h4>Existing Processes</h4>
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>ID</th>
                                    <th>Process Name</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="processes-list-body"></tbody>
                        </table>

                    </div>
                </div>
            </div>

            <!-- VIEW: History -->
            <div id="view-history" class="view hidden">
                <div class="panel">
                    <div class="panel-header">Execution History</div>
                    <div class="panel-body">
                        <table class="data-table">
                            <thead>
                                <tr>
                                    <th>Time</th>
                                    <th>Process</th>
                                    <th>Status</th>
                                    <th>Log Location</th>
                                </tr>
                            </thead>
                            <tbody id="history-list-body"></tbody>
                        </table>
                    </div>
                </div>
            </div>


            <!-- VIEW: Database -->
            <div id="view-database" class="view hidden">
                <div class="panel">
                    <div class="panel-header" style="flex-shrink: 0;">
                        <span>Database Query Tool</span>
                        <div class="header-actions">
                            <button id="btn-show-tables" class="btn btn-sm btn-primary">Show Tables</button>
                            <button id="btn-clear-query" class="btn btn-sm">Clear</button>
                        </div>
                    </div>

                    <div class="panel-body" style="display: flex; flex-direction: column; gap: 20px; overflow-y: auto;">

                        <!-- Tables Info Section -->
                        <div id="tables-info-section" class="hidden"
                            style="background: #2d2d2d; padding: 15px; border-radius: 8px; border: 1px solid #444;">
                            <h4 style="margin-top: 0; color: #4fc3f7;">Available Tables</h4>
                            <div id="tables-list"
                                style="display: flex; flex-wrap: wrap; gap: 10px; margin-bottom: 15px;">
                                <!-- Tables will be populated here -->
                            </div>
                            <div id="table-schema-container">
                                <!-- Schema will be shown here when table is clicked -->
                            </div>
                        </div>

                        <!-- Query Input Section -->
                        <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; border: 1px solid #444;">
                            <h4 style="margin-top: 0; color: #4fc3f7;">SQL Query</h4>
                            <textarea id="sql-query-input"
                                placeholder="Enter your SQL query here...&#10;Example: SELECT * FROM threads LIMIT 10"
                                style="width: 100%; min-height: 150px; background: #1e1e1e; color: #e0e0e0; border: 1px solid #555; border-radius: 4px; padding: 12px; font-family: 'Courier New', monospace; font-size: 14px; resize: vertical;"></textarea>
                            <div style="margin-top: 10px; display: flex; gap: 10px; align-items: center;">
                                <button id="btn-execute-query" class="btn btn-primary">Execute Query</button>
                                <span id="query-status" style="color: #888; font-size: 0.9em;"></span>
                            </div>
                        </div>

                        <!-- Query Examples -->
                        <div style="background: #2d2d2d; padding: 15px; border-radius: 8px; border: 1px solid #444;">
                            <h4 style="margin-top: 0; color: #4fc3f7;">Quick Examples</h4>
                            <div style="display: flex; flex-wrap: wrap; gap: 8px;">
                                <button class="btn btn-sm example-query" data-query="SELECT * FROM threads LIMIT 10">All
                                    Threads</button>
                                <button class="btn btn-sm example-query" data-query="SELECT * FROM processes">All
                                    Processes</button>
                                <button class="btn btn-sm example-query"
                                    data-query="SELECT * FROM schedules ORDER BY run_time DESC LIMIT 20">Recent
                                    Schedules</button>
                                <button class="btn btn-sm example-query"
                                    data-query="SELECT * FROM executions ORDER BY start_time DESC LIMIT 20">Execution
                                    History</button>
                                <button class="btn btn-sm example-query" data-query="SELECT * FROM skus LIMIT 50">SKU
                                    Data</button>
                                <button class="btn btn-sm example-query"
                                    data-query="SELECT name FROM sqlite_master WHERE type='table'">List Tables</button>
                            </div>
                        </div>

                        <!-- Results Section -->
                        <div id="query-results-section" class="hidden"
                            style="background: #2d2d2d; padding: 15px; border-radius: 8px; border: 1px solid #444;">
                            <div
                                style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 10px;">
                                <h4 style="margin: 0; color: #4fc3f7;">Query Results</h4>
                                <span id="result-count" style="color: #888; font-size: 0.9em;"></span>
                            </div>
                            <div style="overflow-x: auto; max-height: 500px; overflow-y: auto;">
                                <table id="query-results-table" class="data-table" style="min-width: 100%;">
                                    <thead id="results-table-head"></thead>
                                    <tbody id="results-table-body"></tbody>
                                </table>
                            </div>
                        </div>

                        <!-- Success/Error Message -->
                        <div id="query-message-section" class="hidden"
                            style="padding: 15px; border-radius: 8px; border: 1px solid #444;">
                            <p id="query-message" style="margin: 0;"></p>
                        </div>

                    </div>
                </div>
            </div>

            <!-- VIEW: SKU Manager -->
            <div id="view-skus" class="view hidden">
                <div class="panel sku-panel">

                    <!-- 1. Top Toolbar (Actions) -->
                    <div class="panel-header"
                        style="flex-shrink: 0; box-shadow: 0 4px 6px -1px rgba(0,0,0,0.3); z-index: 10;">
                        <span>SKU Database</span>
                        <div class="header-actions">
                            <button id="btn-show-sku-manual" class="btn btn-sm btn-primary">Add Manual</button>
                            <button id="btn-show-sku-upload" class="btn btn-sm btn-success">Upload CSV</button>
                        </div>
                    </div>

                    <!-- 2. Filter Bar -->
                    <div class="filter-bar"
                        style="padding: 10px 20px; background: #2d2d2d; display: flex; gap: 10px; border-bottom: 1px solid #444; align-items: center;">
                        <input type="text" id="filter-search" placeholder="Search Name/SKU..." class="form-input"
                            style="width: 200px; margin-bottom: 0;">
                        <input type="text" id="filter-retailer" placeholder="Retailer" class="form-input"
                            style="width: 150px; margin-bottom: 0;">
                        <input type="text" id="filter-region" placeholder="Region" class="form-input"
                            style="width: 100px; margin-bottom: 0;">
                        <!-- Auto-filter on type, no button needed -->
                        <span id="sku-count-display"
                            style="margin-left: auto; color: #888; font-size: 0.9em;">Loading...</span>
                    </div>

                    <!-- 3. Forms (Overlay/Compact) -->
                    <div id="sku-forms-container" style="background: #252525; border-bottom: 1px solid #444;">
                        <!-- Manual Entry Form -->
                        <div id="sku-manual-form" class="form-box hidden" style="margin: 10px 20px;">
                            <h4>Add Single SKU</h4>
                            <form id="form-add-sku">
                                <div class="form-row">
                                    <input type="text" name="name" placeholder="Name" class="form-input" required>
                                    <input type="text" name="sku" placeholder="SKU (Unique)" class="form-input"
                                        required>
                                    <input type="text" name="base_sku" placeholder="Base SKU" class="form-input">
                                </div>
                                <div class="form-row">
                                    <input type="text" name="retailer" placeholder="Retailer" class="form-input">
                                    <input type="text" name="region" placeholder="Region" class="form-input">
                                    <input type="number" step="0.1" name="rating" placeholder="Rating"
                                        class="form-input">
                                    <input type="number" name="review_count" placeholder="Start Reviews"
                                        class="form-input">
                                </div>
                                <input type="url" name="link" placeholder="Product Link" class="form-input"
                                    style="margin-bottom: 10px;">
                                <div class="form-row">
                                    <button type="submit" class="btn btn-primary">Save Record</button>
                                    <button type="button" class="btn btn-sm"
                                        onclick="document.getElementById('sku-manual-form').classList.add('hidden')"
                                        style="background:#444; color:#fff;">Hide</button>
                                </div>
                            </form>
                        </div>

                        <!-- Upload CSV Form -->
                        <div id="sku-upload-form" class="form-box hidden" style="margin: 10px 20px;">
                            <h4>Upload CSV</h4>
                            <p class="hint">Columns: name, base_sku, sku, retailer, region, link, rating, review_count
                            </p>
                            <form id="form-upload-sku">
                                <input type="file" name="file" accept=".csv" required style="margin-bottom: 10px;">
                                <div style="display: flex; gap: 10px;">
                                    <button type="submit" class="btn btn-success">Upload & Process</button>
                                    <button type="button" class="btn btn-sm"
                                        onclick="document.getElementById('sku-upload-form').classList.add('hidden')"
                                        style="background:#444; color:#fff;">Hide</button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <!-- 4. Data Table (Scrollable) -->
                    <div class="panel-body" style="flex-grow: 1; overflow-y: auto; padding: 0;">
                        <table class="data-table sku-table">
                            <thead
                                style="position: sticky; top: 0; background: #333; z-index: 5; box-shadow: 0 2px 4px rgba(0,0,0,0.5);">
                                <tr>
                                    <th>Region</th>
                                    <th>Retailer</th>
                                    <th>Name</th>
                                    <th>SKU</th>
                                    <th>Link</th>
                                    <th>Rating</th>
                                    <th>Reviews</th>
                                </tr>
                            </thead>
                            <tbody id="skus-list-body"></tbody>
                        </table>
                    </div>

                    <!-- 5. Pagination Footer -->
                    <div class="pagination-footer"
                        style="padding: 10px; background: #222; border-top: 1px solid #444; display: flex; gap: 10px; align-items: center; justify-content: center;">
                        <button id="btn-prev-page" class="btn btn-sm">Previous</button>
                        <span id="page-indicator">Page 1</span>
                        <button id="btn-next-page" class="btn btn-sm">Next</button>
                    </div>

                </div>
            </div>

        </div>
    </main>

    <script src="{{ url_for('static', filename='script.js') }}?v=2"></script>
</body>

</html>